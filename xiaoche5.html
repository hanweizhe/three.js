<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="description" content="" />
		<meta name="author" content="" />
		<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
		<title>小车</title>
		<style type="text/css">
		     html,body {
		     	margin: 0;
		     	padding: 0;
		     	width: 100%;
		     	height: 100%;
		     	font-size: 16px;
		     }
			.canvas-body {
				width: 100%;
				height: 100%;
				text-align: center;
				font-size: 26px;
			}
		</style>
	</head>
	<body>
		<div class="canvas-body">
			动画
			<canvas id="canvas" width="800px" height="600px">您的设备不支持canvas</canvas>
		</div>
		<script src="js/three.min.js" type="text/javascript"></script>
		<script src="js/stats.js" type="text/javascript"></script>
		<script src="js/TrackballControls.js" type="text/javascript"></script>
		<script type="text/javascript">
			var renderer,camera,scene,plane,planeTex,planeMaterial,light,cube,cyline1,cyline2,torus1,torus2,torus3,
				    torus4,rearTex,rearMaterial,frontTex,frontMaterial,asideTex,asideMaterial;
			var controls;	
			var stats;
			var materials=[];
			init();
			animate();
		    function init(){
		    	stats = new Stats();
		    	stats.domElement.style.position='absolute';
		    	stats.domElement.style.left='1000px';
		    	stats.domElement.style.top='100px';
		    	document.body.appendChild(stats.domElement);
		    	
				renderer=new THREE.WebGLRenderer({
					canvas:document.getElementById('canvas'),
					antialias:true//消除锯齿
				});
				renderer.setClearColor(0xffffff);
				renderer.shadowMap.enabled=true;
				renderer.shadowMap.type =THREE.PCFSoftShadowMap;
				renderer.shadowMapSoft=true;
				
				
				scene = new THREE.Scene();
				
				camera = new THREE.PerspectiveCamera(45, 800/600, 0.1, 1000);
				camera.position.set(40,36,-38);
				camera.lookAt(new THREE.Vector3(0,0,0));
				scene.add(camera);
				
				planeTex = THREE.ImageUtils.loadTexture('img/floor.jpg',{},function(){
					renderer.render(scene,camera);
				});
				planeMaterial = new THREE.MeshLambertMaterial({
					map:planeTex
				});
				plane= new THREE.Mesh(new THREE.PlaneGeometry(40,40,30,30),planeMaterial);
				plane.receiveShadow=true;
				plane.rotation.x = -Math.PI/2;
				plane.position.y=0;
				scene.add(plane);
				
				rearTex = THREE.ImageUtils.loadTexture('img/rear.png',{},function(){
					renderer.render(scene,camera);
				});
				rearMaterial = new THREE.MeshLambertMaterial({
					map:rearTex
				});
				
				frontTex = THREE.ImageUtils.loadTexture('img/front.png',{},function(){
					renderer.render(scene,camera);
				});
				frontMaterial = new THREE.MeshLambertMaterial({
					map:frontTex
				});
				
				asideTex = THREE.ImageUtils.loadTexture('img/aside.png',{},function(){
					renderer.render(scene,camera);
				});
				asideMaterial = new THREE.MeshLambertMaterial({
					map:asideTex
				});
				
				topMaterial = new THREE.MeshLambertMaterial({
					color:0xeeee00
				});
				
				materials.push(asideMaterial);
				materials.push(asideMaterial);
				materials.push(topMaterial);
				materials.push(topMaterial);
				materials.push(frontMaterial);
				materials.push(rearMaterial);
		    	cube = new THREE.Mesh(new THREE.BoxGeometry(6,4,8),new THREE.MeshFaceMaterial(
		    		materials
//		    		wireframe:true
		    	));
		    	cube.position.y=1;
		    	cube.castShadow=true;
		    	scene.add(cube);
			    
			    cyline1 = new THREE.Mesh(new THREE.CylinderGeometry(0.2,0.2,8,18,3),new THREE.MeshLambertMaterial({
			    	color:0xbcbcbc
			    }));
			    cyline1.rotation.z=Math.PI/2;
			    cyline1.position.set(0,-1,3);
			    
			    cyline1.castShadow=true;
			    scene.add(cyline1);
			    
			    cyline2 = new THREE.Mesh(new THREE.CylinderGeometry(0.2,0.2,8,18,3),new THREE.MeshLambertMaterial({
			    	color:0xbcbcbc
			    }));
			    cyline2.rotateZ(Math.PI/2);
			    cyline2.position.set(0,-1,-3);
			    
			    cyline2.castShadow=true;
			    scene.add(cyline2);
			    
			    var torus1Tex = THREE.ImageUtils.loadTexture('img/timg.jpeg',{},function(){
					renderer.render(scene,camera);
				});
				var torus1Material = new THREE.MeshLambertMaterial({
					map:torus1Tex
				});
				torus1 = new THREE.Mesh(new THREE.TorusGeometry(1,0.3,12,60),torus1Material);
			    
			    torus1.position.set(4,-0.8,-3.4);
			    torus1.rotation.y=Math.PI/2;
			    torus1.castShadow=true;
			    
			    torus2 = new THREE.Mesh(new THREE.TorusGeometry(1,0.3,12,60),new THREE.MeshLambertMaterial({
			    	color:0xffff00
			    }));
			    torus2.position.set(4,-0.8,2.6);
			    torus2.rotation.y=Math.PI/2;
			    torus2.castShadow=true;
			    
			    torus3 = new THREE.Mesh(new THREE.TorusGeometry(1,0.3,12,60),new THREE.MeshLambertMaterial({
			    	color:0xffff00
			    }));
			    torus3.position.set(-4,-0.8,-3.4);
			    torus3.rotation.y=Math.PI/2;
			    torus3.castShadow=true;
			    
			    torus4 = new THREE.Mesh(new THREE.TorusGeometry(1,0.3,12,60),new THREE.MeshLambertMaterial({
			    	color:0x666666
			    }));
			    torus4.position.set(-4,-0.8,2.6);
			    torus4.rotation.y=Math.PI/2;
			    torus4.castShadow=true;
			    
				scene.add(torus1,torus2,torus3,torus4);
				
				controls =new THREE.TrackballControls(camera,renderer.domElement);
				controls.rotateSpeed = 1.0;
		        controls.zoomSpeed = 1.2;
		        controls.panSpeed = 0.8;
		        controls.noZoom = false;
		        controls.noPan = false;
		        controls.minDistance=20;
		        controls.maxDistance=100;
		        controls.staticMoving = true;
		        controls.dynamicDampingFactor = 0.3;
		        controls.keys = [ 65, 83, 68 ];
		        controls.addEventListener('change', render);
				
			    light = new THREE.PointLight(0xffffff);
				light.position.set(20,30,30);
				light.castShadow=true;
				light.target=cube;
				light.shadow.mapSize.width=2048;
				light.shadow.mapSize.height=2048;
				scene.add(light);
				
				renderer.render(scene,camera);
				id=requestAnimationFrame(draw);
			}
			
			function draw(){
				stats.begin();
//				document.addEventListener('keydown',function(event){
//					switch(event.keyCode){
//						case 87:
//							cube.position.z+=1;
//							break;
//						case 83:
//							break;
//					}
//					init();
//					animate();
//				})
				
				renderer.render(scene,camera);
				id=requestAnimationFrame(draw);
				stats.end();
			}
			function animate(){
		        requestAnimationFrame(animate);
		        controls.update();
		    }
		    function render(){
		        renderer.render(scene, camera);
		    }
		</script>
	</body>
</html>
